<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultrasonic Sensor Web Page</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    #distance {
      font-size: 20px;
    }

    #status {
      font-size: 24px;
      margin-top: 20px;
    }

    #image {
      max-width: 100%;
      height: auto;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Ultrasonic Sensor Web Page</h1>
  <p id="distance">Loading...</p>
  <p id="status">Status: Unknown</p>
  <img id="image" src="" alt="Image">

  <!-- Add audio elements for playing sounds -->
  <audio id="safeAudio" src="safe.mp3"></audio>
  <audio id="dangerAudio" src="danger.mp3"></audio>

  

  <script>
    function updateDistance() {
      // Use AJAX to fetch the distance from the ESP8266
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          var distance = parseInt(xhr.responseText);
          document.getElementById("distance").innerHTML = "Distance: " + distance + " cm";

          // Update status based on distance
          var statusElement = document.getElementById("status");
          if (distance === 0 ) {
            statusElement.innerHTML = "Status: LED ON (Danger)";
            document.body.style.backgroundColor = "red";  // Change background color to red
            document.getElementById("image").src = "danger.jpg";
            playAudio("dangerAudio");
            stopAudio("safeAudio");
          } else if (distance > 20) {
            statusElement.innerHTML = "Status: LED OFF (Safe)";
            document.body.style.backgroundColor = "green";  // Change background color to green
            document.getElementById("image").src = "safe.jpg";
            playAudio("safeAudio");
            stopAudio("dangerAudio");
          } 
        }
      };
      xhr.open("GET", "http://172.30.1.46/", true);
      xhr.send();
    }

    function playAudio(audioId) {
      var audio = document.getElementById(audioId);

      // Check if the audio is already playing to avoid restarting
      if (audio.paused) {
        audio.play();
      }
    }

    function stopAudio(audioId) {
      var audio = document.getElementById(audioId);
      audio.pause();
      audio.currentTime = 0;
    }

    // Update the distance every 1 second
    setInterval(updateDistance, 1000);

    // Initial update
    updateDistance();
  </script>
</body>
</html>